INSERT INTO  CUSTOMERCONTACTPHONE 
(
	UUID,
	PHONENUM,
	EXPRESSCONSENTVOICE,
	EXPRESSCONSENT,
	ESIGNSMSCONSENT,
	LASTEXPRESSCONSENTVOICEUPDATEDATE,
	EXPRESSCONSENTSMS,
	LASTEXPRESSCONSENTSMSUPDATEDATE,
	EXPRESSCONSENTAIVOICE,
	LASTEXPRESSCONSENTAIVOICEUPDATEDATE,
	EXPRESSCONSENTPRERECORDEDMESSAGE,
	LASTEXPRESSCONSENTPRERECORDEDMESSAGEUPDATEDATE,
	CUSTOMERID,
	STATUS,
	TYPEID,
	CREATEDATE,
	LASTUPDATEDATE,
	CREATORID,
	LASTUPDATERID,
	SOURCE,
	HISTORICAL,
	ISDEFAULT,
	UPDATED,
	SOURCEREFERENCEID,
	PHONETYPEREFERENCEID
)
SELECT 
	SYS_GUID() AS UUID,
	REGEXP_REPLACE(esppi.ARPHPHONE, '[^0-9]', '') PHONENUM, 
	'NO' AS EXPRESSCONSENTVOICE,
	CASE WHEN ARPHCALLCONSENT='Y' THEN 'YES' ELSE 'NO' END AS EXPRESSCONSENT ,
	'YES' AS ESIGNSMSCONSENT,
	ARPHCALLCONSENTDATE + 0.5 AS LASTEXPRESSCONSENTVOICEUPDATEDATE,
	CASE WHEN ARPHSMSCONSENT='Y' THEN 'YES' ELSE 'NO' END AS EXPRESSCONSENTSMS,
	ARPHSMSCONSENTDATE + 0.5 AS LASTEXPRESSCONSENTSMSUPDATEDATE,
	CASE WHEN ARPHARTIFICIALVOICECONSENT='Y' THEN 'YES' ELSE 'NO' END AS EXPRESSCONSENTAIVOICE,
	ARPHARTIFICIALVOICECONSENTDATE + 0.5 AS LASTEXPRESSCONSENTAIVOICEUPDATEDATE,
	CASE WHEN ARPHPRERECORDEDMSGCONSENT='Y' THEN 'YES' ELSE 'NO' END AS EXPRESSCONSENTPRERECORDEDMESSAGE,
	ARPHPRERECORDEDMSGCONSENTDATE + 0.5 AS LASTEXPRESSCONSENTPRERECORDEDMESSAGEUPDATEDATE,
	c.CUSTOMERID,
	'GOOD' AS STATUS,
	1 AS TYPEID,
	SYSDATE AS CREATEDATE,
	SYSDATE AS LASTUPDATEDATE,
    (SELECT ID FROM COM_FINVI_OASIS_ACCOUNT_DATAMIG.user_ WHERE USERNAME = 'etlmigrationuser@finvi.com') AS CREATORID,
    (SELECT ID FROM COM_FINVI_OASIS_ACCOUNT_DATAMIG.user_ WHERE USERNAME = 'etlmigrationuser@finvi.com') AS LASTUPDATERID,
	'CLIENT' AS SOURCE,
	'N' AS HISTORICAL,
	esppi.ISPRIMARY AS ISDEFAULT,
	'N' AS UPDATED,	
	(select ID from COM_FINVI_OASIS_static_data_DATAMIG.demographic_source WHERE SOURCE='Client') AS SOURCEREFERENCEID,
	--(SELECT pt.ID FROM COM_FINVI_OASIS_STATIC_DATA_DATAMIG.PHONE_TYPE pt WHERE pt.NAME = 'Home') AS PHONETYPEREFERENCEID
	pt.ID AS PHONETYPEREFERENCEID
FROM  
	ETL_OASIS_DATA_MIG_ACST.ETL_STG_PRTY_PHONE_INFO esppi
	INNER JOIN COM_FINVI_OASIS_ACCOUNT_DATAMIG.CUSTOMER c ON c.MIGRATION_SOURCE_ID =esppi.CONSUMERID
	LEFT JOIN COM_FINVI_OASIS_STATIC_DATA_DATAMIG.PHONE_TYPE pt ON UPPER(pt.NAME) = UPPER(NVL(esppi.ARPHTYPE,'Mobile'))
WHERE REGEXP_REPLACE(esppi.ARPHPHONE, '[^0-9]', '') IS NOT NULL
